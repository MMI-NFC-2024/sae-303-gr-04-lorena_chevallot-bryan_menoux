---
import Layout from "../layouts/Layout.astro";
import photo from "../assets/photo_geographie.jpg";
import Graph1 from "../components/Graph1.astro";
import Graph2 from "../components/Graph2.astro";
import Graph3 from "../components/Graph3.astro";
---

<style>
  /* Style pour le point blanc quand le lien est actif */
  .nav-link.btn-primary .nav-dot {
    background-color: white !important;
  }
</style>

<Layout>
  <!-- Section d'intro -->
  <section class="hero min-h-screen bg-base-100">
    <div
      class="hero-content flex-col lg:flex-row gap-12 max-w-7xl h-full flex items-start pt-48 justify-center"
    >
      <!-- Texte gauche -->
      <div class="lg:w-1/2 flex flex-col justify-center">
        <h1 class="text-5xl font-bold text-base-content">
          Géographie de l'offre culturelle en France
        </h1>

        <h2 class="text-2xl font-semibold text-base-content mt-6">
          Pourquoi cette étape ?
        </h2>

        <p class="py-4 text-base-content">
          Avant d'expliquer les écarts, il faut poser un état des lieux clair de
          la répartition actuelle de l'offre culturelle sur le territoire. Cette
          première étape consiste à visualiser où se trouvent les équipements
          culturels (musées, bibliothèques, salles, cinémas, etc.) et à voir
          s'ils sont équitablement répartis entre les départements.
        </p>
        <p class="py-2 text-base-content">
          Cela nous permet de détecter d'éventuels déséquilibres géographiques
          et de commencer à identifier les territoires moins bien desservis.
        </p>

        <!-- Boutons -->
        <div class="flex flex-wrap gap-4 pt-4"></div>
      </div>

      <!-- Image droite -->
      <div class="card bg-base-200 shadow-xl lg:w-2/3 lg:h-1/2 p-0 rounded-xl">
        <div
          class="card-body items-center justify-center h-full p-0 rounded-xl"
        >
          <img
            src={photo.src}
            alt="Photographie d'un paysage"
            class="rounded-xl"
          />
        </div>
      </div>
    </div>

    <!-- Indicateur scroll -->
    <div
      class="absolute bottom-6 left-1/2 transform -translate-x-1/2 flex flex-col items-center"
    >
      <p class="text-base-content opacity-40 text-sm mb-2">Faites défiler</p>
      <div
        class="w-4 h-4 border-2 border-base-content opacity-40 rounded-full animate-bounce"
      >
      </div>
    </div>
  </section>

  <!-- Section Exploration - Bloc "Explorer les données" -->
  <section class="hero bg-neutral text-neutral-content py-20">
    <div class="hero-content text-center">
      <div class="max-w-3xl flex flex-col items-center">
        <h2 class="text-4xl font-bold mb-4">Explorer les données</h2>
        <p class="text-lg opacity-80 mb-8">
          Consultez la répartition complète des équipements culturels en France
          et comparez les territoires selon leurs dynamiques culturelles.
        </p>
        <div class="flex gap-4 flex-wrap">
          <a href="#densite" class="btn btn-secondary hover:btn-primary">
            Densité culturelle par département
          </a>
          <a href="#carte" class="btn btn-secondary hover:btn-primary">
            Répartition des lieux par type
          </a>
          <a href="#classement" class="btn btn-secondary hover:btn-primary">
            Classement départements
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Menu latéral de navigation -->
  <aside
    class="hidden lg:block fixed left-4 top-1/2 -translate-y-1/2 z-40"
    id="graphNav"
  >
    <div class="card bg-base-200 shadow-xl p-4">
      <div class="flex flex-col gap-3">
        <div class="text-xs font-semibold opacity-60 mb-2">Navigation</div>
        <a
          href="#densite"
          class="nav-link btn btn-sm btn-ghost justify-start gap-2 hover:btn-primary"
          title="Densité culturelle"
          data-section="densite"
        >
          <span class="nav-dot w-2 h-2 rounded-full bg-primary"></span>
          <span class="text-xs">Densité</span>
        </a>
        <a
          href="#carte"
          class="nav-link btn btn-sm btn-ghost justify-start gap-2 hover:btn-primary"
          title="Carte interactive"
          data-section="carte"
        >
          <span class="nav-dot w-2 h-2 rounded-full bg-primary"></span>
          <span class="text-xs">Carte</span>
        </a>
        <a
          href="#classement"
          class="nav-link btn btn-sm btn-ghost justify-start gap-2 hover:btn-primary"
          title="Classement départements"
          data-section="classement"
        >
          <span class="nav-dot w-2 h-2 rounded-full bg-primary"></span>
          <span class="text-xs">Classement</span>
        </a>
        <a
          href="#conclusion"
          class="nav-link btn btn-sm btn-ghost justify-start gap-2 hover:btn-primary"
          title="Conclusion"
          data-section="conclusion"
        >
          <span class="nav-dot w-2 h-2 rounded-full bg-primary"></span>
          <span class="text-xs">Conclusion</span>
        </a>
      </div>
    </div>
  </aside>

  <!-- Section Analyse : Densité par département -->
  <section id="densite" class="relative py-24 px-6 bg-base-100">
    <div
      class="max-w-[75dvw] mx-auto grid grid-cols-1 lg:grid-cols-2 gap-12 items-start"
    >
      <!-- Graphique à gauche -->
      <div class="relative">
        <div
          class="relative card bg-base-200 shadow-xl rounded-2xl overflow-hidden"
        >
          <div
            class="p-4 border-b border-base-300 flex items-center justify-between"
          >
            <span class="badge badge-primary badge-lg">Graphique</span>
            <div class="join">
              <span class="join-item badge">France</span>
              <span class="join-item badge">Départements</span>
            </div>
          </div>
          <div class="p-4">
            <Graph1 />
          </div>
        </div>
      </div>

      <!-- Explication à droite -->
      <aside class="space-y-6 lg:sticky gap-6 lg:top-24">
        <div class="inline-flex items-center gap-2">
          <div class="w-2.5 h-2.5 rounded-full bg-primary"></div>
          <div class="w-2.5 h-2.5 rounded-full bg-secondary"></div>
          <div class="w-2.5 h-2.5 rounded-full bg-secondary"></div>
          <span class="text-sm opacity-60">Étape 1 — Géographie de l’offre</span
          >
        </div>

        <h3 class="text-3xl font-bold">Densité culturelle par département</h3>

        <h4 class="text-1xl font-medium">Ce que l’on voit</h4>

        <p class="leading-relaxed">
          Le graphique présente deux listes opposées : les départements qui
          concentrent le plus d’équipements culturels rapportés à la population
          et ceux qui en comptent le moins. L’écart entre le haut et le bas du
          classement est net, ce qui traduit de fortes disparités territoriales.
        </p>
        <h4 class="text-1xl font-medium">Comment l’interpréter</h4>

        <p class="leading-relaxed">
          L’indicateur par habitant est utile pour comparer équitablement des
          territoires de tailles différentes. Attention toutefois aux effets de
          structure : un petit département touristique peut apparaître très bien
          doté, tandis qu’un département très peu dense peut sembler sous-doté
          alors que l’offre est proportionnée aux besoins locaux. Ce classement
          sert donc de diagnostic rapide pour repérer des zones prioritaires, à
          compléter par des analyses locales (réseaux de transport, distances
          réelles, profils de population).
        </p>

        <div class="divider my-2">Bases de données utilisées</div>
        <ul class="space-y-3">
          <li>
            <a
              href="https://data.culture.gouv.fr/explore/dataset/base-des-lieux-et-des-equipements-culturels/information/?disjunctive.sous_domaine&disjunctive.region&disjunctive.type_equipement_ou_lieu&disjunctive.domaine&disjunctive.label_et_appellation&disjunctive.departement&disjunctive.precision_equipement"
              target="_blank"
              rel="noopener noreferrer"
              class="text-blue-500 hover:text-blue-700 hover:underline transition font-medium"
            >
              Lien vers la base des lieux et équipements culturels
            </a>
          </li>
        </ul>
      </aside>
    </div>
  </section>

  <!-- Section Analyse : Filtrage par type de lieu (musées, bibliothèques, cinémas...) -->
  <section id="carte" class="relative py-24 px-6 bg-base-100">
    <div
      class="max-w-[75dvw] mx-auto grid grid-cols-1 lg:grid-cols-2 gap-12 items-start"
    >
      <!-- Graphique à gauche -->
      <div class="relative">
        <div
          class="absolute -inset-2 rounded-2xl bg-gradient-to-br from-base-300 to-base-200 opacity-60 blur-md"
        >
        </div>
        <div
          class="relative card bg-base-200 shadow-xl rounded-2xl overflow-hidden"
        >
          <div
            class="p-4 border-b border-base-300 flex items-center justify-between"
          >
            <span class="badge badge-primary badge-lg">Graphique</span>
            <div class="join">
              <span class="join-item badge">France</span>
              <span class="join-item badge">Départements</span>
            </div>
          </div>
          <div class="p-4">
            <Graph2 />
          </div>
        </div>
      </div>

      <!-- Explication à droite -->
      <aside class="space-y-6 lg:sticky gap-6 lg:top-24">
        <div class="inline-flex items-center gap-2">
          <div class="w-2.5 h-2.5 rounded-full bg-secondary"></div>
          <div class="w-2.5 h-2.5 rounded-full bg-primary"></div>
          <div class="w-2.5 h-2.5 rounded-full bg-secondary"></div>
          <span class="text-sm opacity-60">Étape 2 — Géographie de l’offre</span
          >
        </div>

        <h3 class="text-3xl font-bold">
          Répartition des lieux par type (carte interactive)
        </h3>

        <h4 class="text-1xl font-medium">Ce que l’on voit</h4>

        <p class="leading-relaxed">
          Cette visualisation, plus fine que la carte par département, localise
          précisément chaque équipement et se filtre par type (musées, cinémas,
          bibliothèques, etc.). On observe une forte concentration de points
          autour des grandes métropoles (Paris, Lyon, Marseille, Bordeaux…), où
          se regroupe l’essentiel de l’offre. À mesure qu’on s’éloigne de ces
          pôles, le maillage se clairseme, surtout dans de larges corridors
          ruraux.
        </p>
        <h4 class="text-1xl font-medium">Comment l’interpréter</h4>

        <p class="leading-relaxed">
          La concentration urbaine reflète la densité de population,
          l’attractivité et les infrastructures, mais ne garantit pas un accès
          égal pour tous. Cette carte montre la présence, pas l’usage : il faut
          la croiser avec des indicateurs “par habitant”, des temps d’accès et
          l’offre de transport. Le filtrage par type révèle des logiques propres
          (cinémas/salles très métropolitains, bibliothèques plus diffusées) et
          aide à repérer à la fois des “trous” de maillage à combler et des
          zones de redondance où mieux répartir l’offre.
        </p>

        <div class="divider my-2">Bases de données utilisées</div>
        <ul class="space-y-3">
          <li>
            <a
              href="https://data.culture.gouv.fr/explore/dataset/base-des-lieux-et-des-equipements-culturels/information/?disjunctive.sous_domaine&disjunctive.region&disjunctive.type_equipement_ou_lieu&disjunctive.domaine&disjunctive.label_et_appellation&disjunctive.departement&disjunctive.precision_equipement"
              target="_blank"
              rel="noopener noreferrer"
              class="text-blue-500 hover:text-blue-700 hover:underline transition font-medium"
            >
              Lien vers la base des lieux et équipements culturels
            </a>
          </li>
        </ul>
      </aside>
    </div>
  </section>

  <!-- Section Analyse : Classement des 10 départements les mieux et les moins bien dotés en lieux culturels par habitant -->
  <section id="classement" class="relative py-24 px-6 bg-base-100">
    <div
      class="max-w-[75dvw] mx-auto grid grid-cols-1 lg:grid-cols-2 gap-12 items-start"
    >
      <!-- Graphique à gauche -->
      <div class="relative">
        <div
          class="absolute -inset-2 rounded-2xl bg-gradient-to-br from-base-300 to-base-200 opacity-60 blur-md"
        >
        </div>
        <div
          class="relative card bg-base-200 shadow-xl rounded-2xl overflow-hidden"
        >
          <div
            class="p-4 border-b border-base-300 flex items-center justify-between"
          >
            <span class="badge badge-primary badge-lg">Graphique</span>
            <div class="join">
              <span class="join-item badge">France</span>
              <span class="join-item badge">Départements</span>
            </div>
          </div>
          <div class="p-4">
            <Graph3 />
          </div>
        </div>
      </div>

      <!-- Explication à droite -->
      <aside class="space-y-6 lg:sticky gap-6 lg:top-24">
        <div class="inline-flex items-center gap-2">
          <div class="w-2.5 h-2.5 rounded-full bg-secondary"></div>
          <div class="w-2.5 h-2.5 rounded-full bg-secondary"></div>
          <div class="w-2.5 h-2.5 rounded-full bg-primary"></div>
          <span class="text-sm opacity-60">Étape 3 — Géographie de l’offre</span
          >
        </div>

        <h3 class="text-3xl font-bold">
          Classement des 10 départements les mieux et les moins dotés (lieux
          culturels par habitant)
        </h3>

        <h4 class="text-1xl font-medium">Ce que l’on voit</h4>

        <p class="leading-relaxed">
          Le graphique oppose deux listes : en haut, des départements plutôt
          ruraux comme le Cantal, le Lot ou la Lozère qui apparaissent très bien
          dotés par habitant ; en bas, des départements très peuplés comme la
          Seine-Saint-Denis ou le Nord qui ressortent comme moins dotés. L’écart
          entre les deux groupes est marqué, signe de disparités fortes selon
          les profils territoriaux.
        </p>
        <h4 class="text-1xl font-medium">Comment l’interpréter</h4>

        <p class="leading-relaxed">
          Comment l’interpréter L’indicateur « par habitant » favorise
          mécaniquement les territoires peu denses : avec peu d’habitants,
          chaque équipement pèse davantage dans le ratio. À l’inverse, dans les
          zones urbaines, la population est telle qu’il faudrait un volume
          d’équipements bien supérieur pour maintenir un niveau par habitant
          comparable. Ce classement ne dit donc pas tout de l’accessibilité
          culturelle. Pour une lecture fiable, il faut le compléter par la
          densité réelle d’équipements, les temps d’accès, la répartition
          intra-départementale, la capacité d’accueil et l’attractivité des
          lieux.
        </p>

        <div class="divider my-2">Bases de données utilisées</div>
        <ul class="space-y-3">
          <li>
            <a
              href="https://data.culture.gouv.fr/explore/dataset/base-des-lieux-et-des-equipements-culturels/information/?disjunctive.sous_domaine&disjunctive.region&disjunctive.type_equipement_ou_lieu&disjunctive.domaine&disjunctive.label_et_appellation&disjunctive.departement&disjunctive.precision_equipement"
              target="_blank"
              rel="noopener noreferrer"
              class="text-blue-500 hover:text-blue-700 hover:underline transition font-medium"
            >
              Lien vers la base des lieux et équipements culturels
            </a><br />
            <a
              href="https://www.data.gouv.fr/datasets/population"
              rel="noopener noreferrer"
              class="text-blue-500 hover:text-blue-700 hover:underline transition font-medium"
              >Lien vers la base du recensement de la population Française</a
            >
          </li>
        </ul>
      </aside>
    </div>
  </section>

  <!-- Section Conclusion -->
  <section
    id="conclusion"
    class="relative py-32 px-6 bg-gradient-to-br from-base-100 via-base-200 to-base-100 overflow-hidden"
  >
    <!-- Éléments décoratifs d'arrière-plan -->
    <div
      class="absolute top-0 right-0 w-96 h-96 bg-primary opacity-5 rounded-full blur-3xl -mr-48 -mt-48"
    >
    </div>
    <div
      class="absolute bottom-0 left-0 w-96 h-96 bg-secondary opacity-5 rounded-full blur-3xl -ml-48 -mb-48"
    >
    </div>

    <div class="max-w-4xl mx-auto relative z-10">
      <!-- En-tête -->
      <div class="text-center mb-12">
        <div class="inline-flex items-center gap-3 mb-6">
          <div class="h-1 w-12 bg-primary"></div>
          <span
            class="text-sm font-semibold uppercase tracking-widest text-primary"
            >Conclusion</span
          >
          <div class="h-1 w-12 bg-primary"></div>
        </div>
        <h2
          class="text-5xl lg:text-6xl font-bold text-base-content leading-tight"
        >
          Une géographie culturelle révélatrice
        </h2>
      </div>

      <!-- Contenu principal -->
      <div class="space-y-8 text-lg leading-relaxed">
        <p class="text-base-content opacity-90">
          Ces trois visualisations permettent de dresser un
          <strong
            >premier état des lieux de la répartition de l'offre culturelle en
            France</strong
          >. La concentration géographique des équipements culturels révèle une
          inégalité structurelle qui dépasse la simple présence de lieux : c'est
          un enjeu d'accessibilité réelle.
        </p>

        <!-- Points clés -->
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Point 1 -->
          <div
            class="bg-base-300 bg-opacity-50 rounded-xl p-6 border-l-4 border-primary"
          >
            <h3
              class="font-bold text-base-content mb-3 flex items-center gap-2"
            >
              <span class="badge badge-primary">1</span>
              La concentration métropolitaine
            </h3>
            <p class="text-sm text-base-content opacity-85">
              Les équipements culturels se concentrent massivement dans les
              zones les plus peuplées et touristiques, notamment autour des
              grandes métropoles (Paris, Lyon, Marseille, Bordeaux) et du
              littoral. Cette approche à grande échelle met en évidence des
              contrastes territoriaux majeurs sans entrer dans les détails
              communaux.
            </p>
          </div>

          <!-- Point 2 -->
          <div
            class="bg-base-300 bg-opacity-50 rounded-xl p-6 border-l-4 border-primary"
          >
            <h3
              class="font-bold text-base-content mb-3 flex items-center gap-2"
            >
              <span class="badge badge-primary">2</span>
              L'accès dépendant de la proximité urbaine
            </h3>
            <p class="text-sm text-base-content opacity-85">
              Le filtrage par type de lieu (musées, bibliothèques, cinémas)
              affine l'analyse : une forte densité se concentre autour des
              grands centres urbains, tandis que les espaces ruraux apparaissent
              nettement moins dotés. L'accès à la culture reste très dépendant
              de la proximité avec les grandes villes.
            </p>
          </div>

          <!-- Point 3 -->
          <div
            class="bg-base-300 bg-opacity-50 rounded-xl p-6 border-l-4 border-accent md:col-span-2"
          >
            <h3
              class="font-bold text-base-content mb-3 flex items-center gap-2"
            >
              <span class="badge badge-accent">3</span>
              Le paradoxe du classement par habitant
            </h3>
            <p class="text-sm text-base-content opacity-85">
              Le classement des départements révèle un paradoxe fondamental :
              certains territoires ruraux (Cantal, Lot, Lozère) semblent mieux
              équipés par habitant, mais cette proportion élevée est due à leur
              faible population. Dans les départements densément peuplés, même
              avec de nombreux lieux, la pression démographique réduit
              mécaniquement l'accès individuel et les possibilités d'audience.
            </p>
          </div>
        </div>

        <!-- Synthèse -->
        <div
          class="bg-base-300 bg-opacity-50 rounded-2xl p-8 border border-primary/20"
        >
          <h3 class="text-2xl font-bold text-base-content mb-4">
            En résumé : au-delà du nombre de lieux
          </h3>
          <p class="text-base-content opacity-90 mb-4">
            Le nombre de lieux culturels ne garantit pas un accès équitable à la
            culture. Les grandes villes concentrent l'offre, mais la population
            y est telle que les équipements deviennent vite insuffisants. À
            l'inverse, les zones rurales disposent de plus de lieux par
            habitant, mais leur isolement géographique limite leur accessibilité
            réelle.
          </p>
          <p class="text-base-content opacity-90">
            Les inégalités culturelles en France ne tiennent pas seulement à la
            présence de lieux, mais à leur répartition, leur fréquentation et
            leur capacité à toucher les habitants.
          </p>
        </div>
      </div>
      <div class="flex justify-center mt-12 pt-8 border-t border-base-300">
        <a href="/" class="btn btn-primary btn-lg gap-2">
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
            ></path>
          </svg>
          Retour au sommaire
        </a>
      </div>
    </div>
    <!-- Bouton d'action -->

    <script>
      // Script pour afficher/masquer le menu latéral selon le scroll et gérer la section active
      document.addEventListener("DOMContentLoaded", () => {
        const graphNav = document.getElementById("graphNav");
        const firstSection = document.getElementById("densite");
        const lastSection = document.getElementById("conclusion");
        const navLinks = document.querySelectorAll(".nav-link");
        const sections = ["densite", "carte", "classement", "conclusion"];

        if (graphNav && firstSection && lastSection) {
          // Masquer initialement
          graphNav.style.opacity = "0";
          graphNav.style.pointerEvents = "none";
          graphNav.style.transition = "opacity 0.3s ease-in-out";

          const updateActiveLink = () => {
            // Trouver quelle section est visible
            let activeSection = null;
            for (const sectionId of sections) {
              const section = document.getElementById(sectionId);
              if (section) {
                const rect = section.getBoundingClientRect();
                // Section active si son top est proche du haut de la fenêtre
                if (rect.top <= 200 && rect.bottom > 200) {
                  activeSection = sectionId;
                  break;
                }
              }
            }

            // Mettre à jour les styles des liens
            navLinks.forEach((link) => {
              const linkSection = link.getAttribute("data-section");
              if (linkSection === activeSection) {
                link.classList.remove("btn-ghost");
                link.classList.add("btn-primary");
              } else {
                link.classList.remove("btn-primary");
                link.classList.add("btn-ghost");
              }
            });
          };

          const checkVisibility = () => {
            const firstRect = firstSection.getBoundingClientRect();
            const lastRect = lastSection.getBoundingClientRect();

            // Afficher uniquement si la section densité a commencé (top < viewport)
            // ET qu'on n'a pas dépassé la dernière section
            if (firstRect.top <= 100 && lastRect.bottom > 0) {
              graphNav.style.opacity = "1";
              graphNav.style.pointerEvents = "auto";
            } else {
              graphNav.style.opacity = "0";
              graphNav.style.pointerEvents = "none";
            }

            // Mettre à jour le lien actif
            updateActiveLink();
          };

          window.addEventListener("scroll", checkVisibility);
          checkVisibility(); // Vérifier au chargement
        }
      });
    </script>
  </section></Layout
>
